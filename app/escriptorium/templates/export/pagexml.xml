{% load tz %}
<?xml version="1.0" encoding="UTF-8"?>
<PcGts xmlns="https://schema.primaresearch.org/PAGE/gts/pagecontent/2013-07-15" xmlns:xsi="https://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="https://schema.primaresearch.org/PAGE/gts/pagecontent/2013-07-15 https://schema.primaresearch.org/PAGE/gts/pagecontent/2013-07-15/pagecontent.xsd">
	<Metadata>
		<Creator>escriptorium</Creator>
		<Created>{{ value|localtime }}</Created>
		<LastChange>{{ value|localtime }}</LastChange>
	</Metadata>
	<Page imageFilename="{{ part.filename }}" imageWidth="{{ part.image.width  }}" imageHeight="{{ part.image.height  }}">
        {% for line in lines %}{% ifchanged line.block %}{% if not forloop.first %}</TextRegion>{% endif %}
            <TextRegion {% if line.block %}id="{{ line.block.make_external_id }}"{% else %}id="eSc_dummyblock_"
        {% endif%} >{% endifchanged %}
        <Coords points="{{ line.block.box.0 }},{{ line.block.box.1 }} {{ line.block.box.0 }},{{ line.block.box.3 }} {{ line.block.box.2 }},{{ line.block.box.3 }} {{ line.block.box.2 }},{{ line.block.box.1 }} "/>
        <TextLine id="{{ line.make_external_id }}">
            {% if line.mask %}
              <Coords points="{% for pt in line.mask %}{{ pt|join:"," }}{% if not forloop.last %} {% endif %}{% endfor %}"/>
            {% endif %}
            {% if line.baseline %}
                 <Baseline points="{% for pt in line.baseline %}{{ pt|join:"," }}{% if not forloop.last %} {% endif %}{% endfor %}"/>
                <TextEquiv>
                    <Unicode>{{ line.transcription.0.content }}</Unicode>
                </TextEquiv>
            {% endif %}
          </TextLine>
        {% if forloop.last %}</TextRegion>{% endif %}
        {% endfor %}
	</Page>
</PcGts>
